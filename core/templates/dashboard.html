{% extends 'base.html' %}

{% block title %}Dashboard{% endblock %}

{% block content %}
{% load form_filters %}
{% if user.is_superuser or user|has_group:'Admin' or user|has_group:'Lawyers' %}
<!-- Lawyer/Admin Dashboard -->
<div class="lawyer-dashboard">
    <!-- Header Section -->
    <div class="dashboard-header bg-primary text-white py-4 mb-4">
        <div class="container-fluid">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="h2 mb-0">
                        <i class="fas fa-gavel me-3"></i>
                        Welcome, {{ user.get_full_name|default:user.username }}!
                    </h1>
                    <p class="mb-0 mt-2 opacity-75">
                        {% if user|has_group:'Lawyers' %}
                            <i class="fas fa-user-tie me-1"></i>Legal Professional Dashboard
                        {% else %}
                            <i class="fas fa-shield-alt me-1"></i>Administrative Dashboard
                        {% endif %}
                    </p>
                </div>
                <div class="col-md-4">
                    <form class="d-flex" role="search">
                        <input class="form-control me-2" type="search" name="q" placeholder="Search clients or cases..." aria-label="Search" value="{{ request.GET.q }}">
                        <button class="btn btn-light" type="submit">
                            <i class="fas fa-search"></i>
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Summary Statistics Cards -->
    <div class="container-fluid mb-4">
        <div class="row">
            <div class="col-md-3 mb-3">
                <div class="stat-card bg-white shadow-sm rounded">
                    <div class="stat-card-body p-4">
                        <div class="d-flex align-items-center">
                            <div class="stat-icon bg-primary text-white rounded-circle me-3">
                                <i class="fas fa-users"></i>
                            </div>
                            <div>
                                <h3 class="stat-number text-primary mb-0">{{ clients.count }}</h3>
                                <p class="stat-label text-muted mb-0">Total Clients</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="stat-card bg-white shadow-sm rounded">
                    <div class="stat-card-body p-4">
                        <div class="d-flex align-items-center">
                            <div class="stat-icon bg-success text-white rounded-circle me-3">
                                <i class="fas fa-briefcase"></i>
                            </div>
                            <div>
                                <h3 class="stat-number text-success mb-0">{{ cases.count }}</h3>
                                <p class="stat-label text-muted mb-0">Total Cases</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% if user|has_group:'Lawyers' %}
            <div class="col-md-3 mb-3">
                <div class="stat-card bg-white shadow-sm rounded">
                    <div class="stat-card-body p-4">
                        <div class="d-flex align-items-center">
                            <div class="stat-icon bg-warning text-white rounded-circle me-3">
                                <i class="fas fa-calendar-check"></i>
                            </div>
                            <div>
                                <h3 class="stat-number text-warning mb-0">{{ appointment_stats.total_appointments|default:0 }}</h3>
                                <p class="stat-label text-muted mb-0">My Appointments</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="stat-card bg-white shadow-sm rounded">
                    <div class="stat-card-body p-4">
                        <div class="d-flex align-items-center">
                            <div class="stat-icon bg-info text-white rounded-circle me-3">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div>
                                <h3 class="stat-number text-info mb-0">{{ appointment_stats.pending_appointments|default:0 }}</h3>
                                <p class="stat-label text-muted mb-0">Pending</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Action Buttons -->
    <div class="container-fluid mb-4">
        <div class="action-buttons bg-white p-3 rounded shadow-sm">
            <div class="d-flex flex-wrap gap-2">
                <a href="{% url 'client_create' %}" class="btn btn-primary">
                    <i class="fas fa-user-plus me-2"></i>Add Client
                </a>
                <a href="{% url 'case_create' %}" class="btn btn-success">
                    <i class="fas fa-plus me-2"></i>Add Case
                </a>
                {% if user|has_group:'Lawyers' %}
                <a href="{% url 'appointment_list' %}" class="btn btn-warning">
                    <i class="fas fa-calendar-alt me-2"></i>Manage Appointments
                </a>
                <a href="{% url 'lawyer_profile' %}" class="btn btn-info">
                    <i class="fas fa-user-edit me-2"></i>My Profile
                </a>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Lawyer-specific Appointment Section -->
    {% if user|has_group:'Lawyers' %}
    <div class="container-fluid mb-4">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-primary text-white">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="fas fa-calendar-alt me-2"></i>Recent Appointments
                    </h5>
                    <a href="{% url 'appointment_list' %}" class="btn btn-light btn-sm">
                        <i class="fas fa-external-link-alt me-1"></i>View All
                    </a>
                </div>
            </div>
            <div class="card-body p-0">
                {% if appointment_stats.total_appointments > 0 %}
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th class="border-0">Client</th>
                                    <th class="border-0">Date & Time</th>
                                    <th class="border-0">Status</th>
                                    <th class="border-0">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for appt in user.appointments.all|slice:":5" %}
                                    <tr>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div class="avatar-sm bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-2">
                                                    {{ appt.client.name|first|upper }}
                                                </div>
                                                <div>
                                                    <strong>{{ appt.client.name }}</strong>
                                                    <br>
                                                    <small class="text-muted">{{ appt.client.email }}</small>
                                                </div>
                                            </div>
                                        </td>
                                        <td>
                                            <div>
                                                <strong>{{ appt.date|date:"M d, Y" }}</strong>
                                                <br>
                                                <small class="text-muted">{{ appt.time|time:"g:i A" }}</small>
                                            </div>
                                        </td>
                                        <td>
                                            <span class="badge {% if appt.status == 'pending' %}bg-warning{% elif appt.status == 'accepted' %}bg-success{% elif appt.status == 'rejected' %}bg-danger{% elif appt.status == 'rescheduled' %}bg-info{% else %}bg-secondary{% endif %}">
                                                <i class="fas fa-{% if appt.status == 'pending' %}clock{% elif appt.status == 'accepted' %}check{% elif appt.status == 'rejected' %}times{% elif appt.status == 'rescheduled' %}exchange-alt{% else %}circle{% endif %} me-1"></i>
                                                {{ appt.get_status_display }}
                                            </span>
                                        </td>
                                        <td>
                                            <a href="{% url 'appointment_detail' appt.pk %}" class="btn btn-sm btn-outline-primary">
                                                <i class="fas fa-eye me-1"></i>View
                                            </a>
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <div class="text-center py-4">
                        <i class="fas fa-calendar-times fa-2x text-muted mb-3"></i>
                        <p class="text-muted mb-0">No appointments assigned yet.</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Cases and Clients Section -->
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-6 mb-4">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-briefcase me-2"></i>Recent Cases
                        </h5>
                    </div>
                    <div class="card-body p-0">
                        {% if cases %}
                            <div class="table-responsive">
                                <table class="table table-hover mb-0">
                                    <thead class="table-light">
                                        <tr>
                                            <th class="border-0">Title</th>
                                            <th class="border-0">Client</th>
                                            <th class="border-0">Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for case in cases|slice:":5" %}
                                            <tr>
                                                <td>
                                                    <a href="{% url 'case_detail' case.pk %}" class="text-decoration-none">
                                                        <strong>{{ case.title }}</strong>
                                                    </a>
                                                </td>
                                                <td>
                                                    <a href="{% url 'client_detail' case.client.pk %}" class="text-decoration-none">
                                                        {{ case.client.name }}
                                                    </a>
                                                </td>
                                                <td>
                                                    <span class="badge bg-primary">{{ case.get_status_display }}</span>
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        {% else %}
                            <div class="text-center py-4">
                                <i class="fas fa-briefcase fa-2x text-muted mb-3"></i>
                                <p class="text-muted mb-0">No cases found.</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="col-md-6 mb-4">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-users me-2"></i>Recent Clients
                        </h5>
                    </div>
                    <div class="card-body p-0">
                        {% if clients %}
                            <div class="table-responsive">
                                <table class="table table-hover mb-0">
                                    <thead class="table-light">
                                        <tr>
                                            <th class="border-0">Name</th>
                                            <th class="border-0">Email</th>
                                            <th class="border-0">Phone</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for client in clients|slice:":5" %}
                                            <tr>
                                                <td>
                                                    <a href="{% url 'client_detail' client.pk %}" class="text-decoration-none">
                                                        <strong>{{ client.name }}</strong>
                                                    </a>
                                                </td>
                                                <td>{{ client.email }}</td>
                                                <td>{{ client.phone|default:"-" }}</td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        {% else %}
                            <div class="text-center py-4">
                                <i class="fas fa-users fa-2x text-muted mb-3"></i>
                                <p class="text-muted mb-0">No clients found.</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% else %}
<!-- Client Dashboard -->
<div class="client-dashboard">
    <div class="container-fluid">
        <div class="dashboard-header bg-info text-white py-4 mb-4 rounded">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="h2 mb-0">
                        <i class="fas fa-user me-3"></i>
                        Welcome, {{ user.get_full_name|default:user.username }}!
                    </h1>
                    <p class="mb-0 mt-2 opacity-75">
                        <i class="fas fa-home me-1"></i>Client Dashboard
                    </p>
                </div>
                <div class="col-md-4 text-end">
                    <a href="{% url 'book_appointment' %}" class="btn btn-light">
                        <i class="fas fa-calendar-plus me-2"></i>Book Appointment
                    </a>
                </div>
            </div>
        </div>

        <!-- Client Appointments Section -->
        <div class="card border-0 shadow-sm mb-4">
            <div class="card-header bg-info text-white">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="fas fa-calendar-alt me-2"></i>Your Appointments
                    </h5>
                    <a href="{% url 'client_appointments' %}" class="btn btn-light btn-sm">
                        <i class="fas fa-external-link-alt me-1"></i>View All
                    </a>
                </div>
            </div>
            <div class="card-body p-0">
                {% if user.client_profile.appointments.all %}
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th class="border-0">Date & Time</th>
                                    <th class="border-0">Status</th>
                                    <th class="border-0">Reason</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for appt in user.client_profile.appointments.all|slice:":5" %}
                                    <tr>
                                        <td>
                                            <strong>{{ appt.date|date:"M d, Y" }}</strong>
                                            <br>
                                            <small class="text-muted">{{ appt.time|time:"g:i A" }}</small>
                                        </td>
                                        <td>
                                            <span class="badge {% if appt.status == 'pending' %}bg-warning{% elif appt.status == 'accepted' %}bg-success{% elif appt.status == 'rejected' %}bg-danger{% elif appt.status == 'rescheduled' %}bg-info{% else %}bg-secondary{% endif %}">
                                                {{ appt.get_status_display }}
                                            </span>
                                        </td>
                                        <td>{{ appt.message|truncatewords:5|default:"No reason provided" }}</td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <div class="text-center py-4">
                        <i class="fas fa-calendar-times fa-2x text-muted mb-3"></i>
                        <p class="text-muted mb-0">No appointments booked yet.</p>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Client Cases Section -->
        <div class="row">
            <div class="col-12">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-briefcase me-2"></i>Your Cases
                        </h5>
                    </div>
                    <div class="card-body p-0">
                        {% if cases %}
                            <div class="table-responsive">
                                <table class="table table-hover mb-0">
                                    <thead class="table-light">
                                        <tr>
                                            <th class="border-0">Title</th>
                                            <th class="border-0">Status</th>
                                            <th class="border-0">Opened</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for case in cases|slice:":5" %}
                                            <tr>
                                                <td>
                                                    <a href="{% url 'case_detail' case.pk %}" class="text-decoration-none">
                                                        <strong>{{ case.title }}</strong>
                                                    </a>
                                                </td>
                                                <td>
                                                    <span class="badge bg-primary">{{ case.get_status_display }}</span>
                                                </td>
                                                <td>{{ case.opened_on|date:"M d, Y" }}</td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        {% else %}
                            <div class="text-center py-4">
                                <i class="fas fa-briefcase fa-2x text-muted mb-3"></i>
                                <p class="text-muted mb-0">No cases found.</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}

<style>
/* Lawyer Dashboard Styles */
.lawyer-dashboard {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    min-height: 100vh;
    padding: 20px 0;
}

.dashboard-header {
    background: linear-gradient(135deg, #007bff 0%, #0056b3 100%) !important;
    border-radius: 10px;
    box-shadow: 0 4px 15px rgba(0, 123, 255, 0.2);
}

.stat-card {
    transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
    border: 1px solid #e9ecef;
}

.stat-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1) !important;
}

.stat-icon {
    width: 50px;
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
}

.stat-number {
    font-size: 2rem;
    font-weight: 700;
}

.stat-label {
    font-size: 0.9rem;
    font-weight: 500;
}

.action-buttons {
    border: 1px solid #e9ecef;
}

.card {
    border-radius: 10px;
    overflow: hidden;
}

.card-header {
    border-bottom: none;
    padding: 1rem 1.5rem;
}

.avatar-sm {
    width: 32px;
    height: 32px;
    font-size: 14px;
}

.table th {
    font-weight: 600;
    color: #495057;
}

.table td {
    vertical-align: middle;
}

.badge {
    font-size: 0.75rem;
    padding: 0.5em 0.75em;
}

/* Client Dashboard Styles */
.client-dashboard {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    min-height: 100vh;
    padding: 20px 0;
}

.opacity-75 {
    opacity: 0.75;
}

/* Responsive Design */
@media (max-width: 768px) {
    .dashboard-header h1 {
        font-size: 1.5rem;
    }
    
    .stat-number {
        font-size: 1.5rem;
    }
    
    .action-buttons .btn {
        width: 100%;
        margin-bottom: 0.5rem;
    }
}
</style>
